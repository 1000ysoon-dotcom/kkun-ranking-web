<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>[ADMIN] ì‹ ì´Œ ê¾¼ ë‚šì‹œì¹´í˜ ë­í‚¹ë³´ë“œ</title>

  <!-- í°íŠ¸ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg1: #020617;
      --bg2: #020920;
      --card: rgba(15, 23, 42, 0.96);
      --card-soft: rgba(15, 23, 42, 0.9);
      --line: rgba(56, 189, 248, 0.55);
      --muted: #9ca3af;
      --text: #e5e7eb;
      --neon: #38bdf8;
      --radius: 18px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.9);
    }

    * { box-sizing: border-box; }
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: var(--text);
      font-family: "Noto Sans KR", system-ui, -apple-system, BlinkMacSystemFont;
      background:
        radial-gradient(circle at 0% 0%, #0f172a 0, transparent 55%),
        radial-gradient(circle at 100% 100%, #020617 0, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    .wrap {
      max-width: 1180px;
      margin: 0 auto;
      padding: 20px 16px 40px;
    }

    header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 16px;
    }

    .logo {
      width: 46px;
      height: 46px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #e0f2fe, #0ea5e9 40%, #0369a1 70%, #020617 100%);
      box-shadow:
        0 0 18px rgba(56, 189, 248, 0.9),
        0 0 40px rgba(8, 47, 73, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0f172a;
      font-family: "Jua";
      font-size: 22px;
    }

    .title-main {
      font-family: "Jua";
      font-size: 22px;
      letter-spacing: 0.03em;
    }

    .title-sub {
      font-size: 11px;
      color: var(--muted);
    }

    .header-right {
      margin-left: auto;
      text-align: right;
      font-size: 11px;
      color: var(--muted);
    }

    .header-right strong {
      color: var(--neon);
    }

    /* ì¹´ë“œ ê³µí†µ */
    .grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(12, 1fr);
    }

    .card {
      grid-column: span 12;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      padding: 14px 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      position: relative;
      overflow: hidden;
    }

    .card-soft {
      background: var(--card-soft);
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      border: 1px solid transparent;
      background:
        linear-gradient(135deg, rgba(56, 189, 248, 0.5), transparent 35%, transparent 65%, rgba(59, 130, 246, 0.4)) border-box;
      mask:
        linear-gradient(#000 0 0) padding-box,
        linear-gradient(#000 0 0);
      mask-composite: exclude;
      opacity: 0.55;
      pointer-events: none;
    }

    @media (min-width: 880px) {
      .half { grid-column: span 6; }
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      font-family: "Jua";
      font-size: 16px;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--muted);
      margin-left: 6px;
    }

    .tag-primary {
      border-color: rgba(56, 189, 248, 0.8);
      color: var(--neon);
      background: rgba(8, 47, 73, 0.7);
    }

    .desc {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .btn {
      border: 0;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #0ea5e9, #2563eb);
      color: #f9fafb;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn:hover {
      box-shadow: 0 0 18px rgba(56, 189, 248, 0.7);
    }

    .btn-outline {
      background: transparent;
      color: var(--neon);
      border: 1px solid rgba(56, 189, 248, 0.8);
      box-shadow: none;
    }

    .btn-danger {
      background: linear-gradient(135deg, #fb7185, #f97316);
      border-color: transparent;
    }

    input[type="text"],
    input[type="password"],
    select,
    textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      font-size: 12px;
    }

    textarea {
      border-radius: 12px;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(148, 163, 184, 0.7);
    }

    .row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .row + .row {
      margin-top: 6px;
    }

    .spacer {
      flex: 1;
    }

    /* ë¡œê·¸ì¸/ì„¤ì • ê²Œì´íŠ¸ */
    .gate {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      padding: 14px 16px 16px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      margin-bottom: 18px;
    }

    .gate-title {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .gate-title-text {
      font-family: "Jua";
      font-size: 16px;
    }

    .gate-msg {
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
    }

    /* í…Œì´ë¸”(Top 5 ì…ë ¥) */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 6px;
      font-size: 12px;
    }

    thead th {
      text-align: left;
      color: var(--muted);
      padding: 4px 6px;
      font-size: 11px;
    }

    tbody tr {
      background: rgba(15, 23, 42, 0.85);
      border-radius: 12px;
      overflow: hidden;
    }

    tbody td {
      padding: 6px 6px;
    }

    tbody td:first-child {
      width: 30px;
      text-align: center;
      color: rgba(148, 163, 184, 0.9);
    }

    /* ë¹™ê³  ì—ë””í„° */
    .bingo-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
    }

    .bingo-cell {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 14px;
      padding: 8px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .bingo-cell.used {
      background: radial-gradient(circle at 100% 100%, rgba(148, 163, 184, 0.25), rgba(15, 23, 42, 0.95));
      border-color: rgba(148, 163, 184, 0.9);
    }

    .bingo-label-row input {
      border-radius: 999px;
    }

    .bingo-btn-row button {
      width: 100%;
      justify-content: center;
      padding: 6px 8px;
      font-size: 11px;
    }

    /* ì‹œì¦Œì „ ì „ì²´ ë­í‚¹ ê´€ë¦¬ */
    .season-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 4px;
      font-size: 12px;
    }

    .season-table tbody tr {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
    }

    .season-table td {
      padding: 4px 6px;
    }

    .season-table td:first-child {
      width: 32px;
      text-align: right;
      color: rgba(148, 163, 184, 0.9);
      font-variant-numeric: tabular-nums;
      font-size: 11px;
    }

    .season-row-actions {
      width: 40px;
      text-align: center;
    }

    .link-danger {
      color: #fb7185;
      font-size: 11px;
      cursor: pointer;
    }

    .link-danger:hover {
      text-decoration: underline;
    }

    .footer {
      margin-top: 18px;
      font-size: 11px;
      text-align: center;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true">ê¾¼</div>
      <div>
        <div class="title-main">[ADMIN] ì‹ ì´Œ ê¾¼ ë‚šì‹œì¹´í˜ ë­í‚¹ë³´ë“œ</div>
        <div class="title-sub">Supabaseì— ì €ì¥ë˜ëŠ” ê³µì‹ ë­í‚¹ & ì¹˜í‚¨ë¹™ê³  Â· ì´ í™”ë©´ì€ ì‚¬ì¥ë‹˜/ì§ì› ì „ìš©</div>
      </div>
      <div class="header-right">
        <div>ë§ˆì§€ë§‰ ì €ì¥: <strong id="lastSaved">-</strong></div>
        <div style="margin-top:2px;">Alt + A â†’ ë¹„ë°€ë²ˆí˜¸ ì°½ ì—´ê¸°</div>
      </div>
    </header>

    <!-- ë¡œê·¸ì¸/ì„¤ì • ê²Œì´íŠ¸ -->
    <section class="gate" id="gate">
      <div class="gate-title">
        <span style="font-size:16px;">âš™ï¸</span>
        <div class="gate-title-text">ê´€ë¦¬ì ì ê¸ˆ</div>
      </div>

      <!-- ìµœì´ˆ ì„¤ì • ë°•ìŠ¤ -->
      <div id="setupBox" style="display:none;">
        <div class="row">
          <input id="newPw" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" autocomplete="new-password" />
        </div>
        <div class="row">
          <input id="newPw2" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸" autocomplete="new-password" />
        </div>
        <div class="row" style="margin-top:8px;">
          <button class="btn" id="setPwBtn">ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</button>
        </div>
        <div class="gate-msg">ìµœì´ˆ 1íšŒ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”. (SHA-256 í•´ì‹œë¡œ ì´ PCì˜ localStorageì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.)</div>
      </div>

      <!-- ë¡œê·¸ì¸ ë°•ìŠ¤ -->
      <div id="loginBox" style="display:none;">
        <div class="row">
          <input id="pw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" autocomplete="current-password" />
          <button class="btn" id="loginBtn">ì…ì¥</button>
        </div>
        <div class="gate-msg" id="gateMsg">Alt + Aë¥¼ ëˆŒëŸ¬ ì–¸ì œë“ ì§€ ì´ ì°½ì„ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
      </div>
    </section>

    <!-- ì§„ì§œ íŒ¨ë„ -->
    <div id="panel" style="display:none;">
      <div class="row" style="margin-bottom:12px; align-items:center;">
        <span class="desc">ë³´ì•ˆ: ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ Â· Alt + A ê²Œì´íŠ¸ Â· ë¡œê·¸ì¸ ì‹œë„ ì œí•œ(5íšŒ)</span>
        <div class="spacer"></div>
        <button class="btn btn-outline" id="changePwToggle">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
      </div>

      <section class="card card-soft" id="changePwBox" style="display:none; margin-bottom:16px;">
        <div class="card-header">
          <div class="card-title">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
        </div>
        <div class="row">
          <input id="curPw" type="password" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸" />
        </div>
        <div class="row">
          <input id="npw1" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" />
        </div>
        <div class="row">
          <input id="npw2" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸" />
        </div>
        <div class="row" style="margin-top:8px;">
          <button class="btn" id="applyPwBtn">ë³€ê²½</button>
          <div class="spacer"></div>
          <span class="desc">â€» ë¹„ë°€ë²ˆí˜¸ëŠ” ì´ PCì˜ localStorageì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.</span>
        </div>
      </section>

      <!-- ê²Œì„/ë¹™ê³  ì œëª© ì„¤ì • -->
      <section class="card card-soft" id="titleCard" style="margin-bottom:16px;">
        <div class="card-header">
          <div class="card-title">ê²Œì„ & ë¹™ê³  ì œëª© ì„¤ì •</div>
        </div>
        <div class="desc">
          ì—¬ê¸°ì„œ ì…ë ¥í•œ ì œëª©ì€ Supabaseì— ì €ì¥ë˜ë©°, ì†ë‹˜ìš© ë­í‚¹ë³´ë“œ(index.html / kkun-ranking-v2.html)ì— ìë™ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.
        </div>
        <div class="row">
          <label style="width:120px;font-size:12px;">ëŒ€ë¬¼ì™• ì œëª©</label>
          <input type="text" id="title_rank_big" placeholder="ì˜ˆ: ëŒ€ë¬¼ì™•" />
        </div>
        <div class="row">
          <label style="width:120px;font-size:12px;">ì†Œë¬¼ì™• ì œëª©</label>
          <input type="text" id="title_rank_small" placeholder="ì˜ˆ: ì†Œë¬¼ì™•" />
        </div>
        <div class="row">
          <label style="width:120px;font-size:12px;">ì²œí•˜ì œì¼ ëŒ€íšŒ</label>
          <input type="text" id="title_rank_tour" placeholder="ì˜ˆ: ì²œí•˜ì œì¼ ë‚šì‹œëŒ€íšŒ" />
        </div>
        <div class="row">
          <label style="width:120px;font-size:12px;">ì‹œì¦Œì „ ì œëª©</label>
          <input type="text" id="title_rank_season" placeholder="ì˜ˆ: ì‹œì¦Œì „" />
        </div>
        <div class="row">
          <label style="width:120px;font-size:12px;">ì¹˜í‚¨ë¹™ê³  ì œëª©</label>
          <input type="text" id="title_bingo" placeholder="ì˜ˆ: ì¹˜í‚¨ë¹™ê³ " />
        </div>
        <div class="row" style="margin-top:6px;">
          <span class="desc">â€» ì œëª©ë§Œ ë°”ê¿”ë„ ì†ë‹˜ í™”ë©´ì—ëŠ” ë°”ë¡œ ìƒˆ ì´ë¦„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤. (ë­í‚¹/ë¹™ê³  ë°ì´í„°ëŠ” ê·¸ëŒ€ë¡œ)</span>
        </div>
      </section>

      <!-- ğŸ”¹ ê²Œì„ë³„ ìƒí’ˆ(ë“±ìˆ˜) ì„¤ì • -->
      <section class="card card-soft" id="prizeCard" style="margin-bottom:16px;">
        <div class="card-header">
          <div class="card-title">ê²Œì„ë³„ ìƒí’ˆ(ë“±ìˆ˜) ì„¤ì •</div>
        </div>
        <div class="desc">
          ê° ê²Œì„ì˜ 1~5ë“± ìƒí’ˆëª…ì„ ì„¤ì •í•˜ë©´ Supabaseì— ì €ì¥ë˜ê³ , ì†ë‹˜ìš© ë­í‚¹ë³´ë“œ í™”ë©´ì— ë°”ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.
          (ë¹ˆì¹¸ìœ¼ë¡œ ë‘ë©´ í•´ë‹¹ ë“±ìˆ˜ ìƒí’ˆì€ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)
        </div>

        <!-- ëŒ€ë¬¼ì™• -->
        <div style="margin-top:4px; font-size:12px; font-weight:600;">ëŒ€ë¬¼ì™•</div>
        <div class="row">
          <label style="width:80px;font-size:12px;">1ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_big_0" placeholder="ì˜ˆ: 50,000P" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">2ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_big_1" placeholder="ì˜ˆ: 30,000P" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">3ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_big_2" placeholder="ì˜ˆ: 10,000P" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">4ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_big_3" placeholder="ì˜ˆ: 5,000P" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">5ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_big_4" placeholder="ì˜ˆ: 3,000P" />
        </div>

        <!-- ì†Œë¬¼ì™• -->
        <div style="margin-top:10px; font-size:12px; font-weight:600;">ì†Œë¬¼ì™•</div>
        <div class="row">
          <label style="width:80px;font-size:12px;">1ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_small_0" placeholder="ì˜ˆ: 50,000P" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">2ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_small_1" placeholder="ì˜ˆ: 30,000P" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">3ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_small_2" placeholder="ì˜ˆ: 10,000P" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">4ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_small_3" placeholder="ì˜ˆ: 5,000P" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">5ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_small_4" placeholder="ì˜ˆ: 3,000P" />
        </div>

        <!-- ì²œí•˜ì œì¼ ë‚šì‹œëŒ€íšŒ -->
        <div style="margin-top:10px; font-size:12px; font-weight:600;">ì²œí•˜ì œì¼ ë‚šì‹œëŒ€íšŒ</div>
        <div class="row">
          <label style="width:80px;font-size:12px;">1ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_tour_0" placeholder="ì˜ˆ: 1ì‹œê°„ í• ì¸ê¶Œ 3ì¥" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">2ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_tour_1" placeholder="ì˜ˆ: 1ì‹œê°„ í• ì¸ê¶Œ 1ì¥" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">3ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_tour_2" placeholder="ì˜ˆ: 4,000ì› í• ì¸ê¶Œ 1ì¥" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">4ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_tour_3" placeholder="ì˜ˆ: 3,000ì› í• ì¸ê¶Œ 1ì¥" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">5ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_tour_4" placeholder="ì˜ˆ: 2,000ì› í• ì¸ê¶Œ 1ì¥" />
        </div>

        <!-- ì‹œì¦Œì „ -->
        <div style="margin-top:10px; font-size:12px; font-weight:600;">ì‹œì¦Œì „</div>
        <div class="row">
          <label style="width:80px;font-size:12px;">1ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_season_0" placeholder="ì˜ˆ: 10ë§ŒP + 1ì‹œê°„ í• ì¸ê¶Œ 3ì¥" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">2ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_season_1" placeholder="ì˜ˆ: 7ë§ŒP + 1ì‹œê°„ í• ì¸ê¶Œ 2ì¥" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">3ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_season_2" placeholder="ì˜ˆ: 3ë§ŒP + 1ë§Œì› í• ì¸ê¶Œ 1ì¥" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">4ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_season_3" placeholder="(í•„ìš” ì—†ìœ¼ë©´ ë¹„ì›Œë‘ê¸°)" />
        </div>
        <div class="row">
          <label style="width:80px;font-size:12px;">5ë“± ìƒí’ˆ</label>
          <input type="text" id="prize_rank_season_4" placeholder="(í•„ìš” ì—†ìœ¼ë©´ ë¹„ì›Œë‘ê¸°)" />
        </div>
      </section>

      <div class="grid">
        <!-- ëŒ€ë¬¼/ì†Œë¬¼/ì²œí•˜ì œì¼/ì‹œì¦Œ Top5 -->
        <section class="card half">
          <div class="card-header">
            <div class="card-title" data-title-display="rank_big">ëŒ€ë¬¼ì™•</div>
            <span class="tag tag-primary">Top 5</span>
          </div>
          <div class="desc">ì´ë¦„ / ì ìˆ˜ (ë¬´ê²Œ, í¬ì¸íŠ¸ ë“±). ì†ë‹˜ í™”ë©´ì—ëŠ” ì ìˆ˜ ê¸°ì¤€ ìë™ ì •ë ¬ë¡œ ë…¸ì¶œë©ë‹ˆë‹¤.</div>
          <div data-key="rank_big"></div>
        </section>

        <section class="card half">
          <div class="card-header">
            <div class="card-title" data-title-display="rank_small">ì†Œë¬¼ì™•</div>
            <span class="tag tag-primary">Top 5</span>
          </div>
          <div class="desc">ê·€ì—¬ìš´ ë¬¼ê³ ê¸°, ì´ë²¤íŠ¸ìš© ê¸°ë¡ ë“±.</div>
          <div data-key="rank_small"></div>
        </section>

        <section class="card half">
          <div class="card-header">
            <div class="card-title" data-title-display="rank_tour">ì²œí•˜ì œì¼ ë‚šì‹œëŒ€íšŒ</div>
            <span class="tag tag-primary">Top 5</span>
          </div>
          <div class="desc">íŠ¹ë³„ ì´ë²¤íŠ¸/ëŒ€íšŒ ìˆœìœ„ ì…ë ¥.</div>
          <div data-key="rank_tour"></div>
        </section>

        <section class="card half">
          <div class="card-header">
            <div class="card-title" data-title-display="rank_season">ì‹œì¦Œì „ Top 5</div>
            <span class="tag tag-primary">ëª©ë¡ì—ì„œ ìë™ ì‚°ì¶œ</span>
          </div>
          <div class="desc">
            ì•„ë˜ â€œì‹œì¦Œì „ ì „ì²´ ë­í‚¹â€ì— ì…ë ¥ëœ ê°’ ê¸°ì¤€ìœ¼ë¡œ ì†ë‹˜ í™”ë©´ Top 5ê°€ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.
          </div>
          <div style="font-size:11px; color:var(--muted);">â€» ë³„ë„ì˜ ì…ë ¥ ì—†ì´ ì „ì²´ ë­í‚¹ í…Œì´ë¸” ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.</div>
        </section>

        <!-- ì¹˜í‚¨ë¹™ê³  -->
        <section class="card" id="bingoCard">
          <div class="card-header">
            <div class="card-title" data-title-display="bingo">ì¹˜í‚¨ë¹™ê³  4 Ã— 4</div>
          </div>
          <div class="desc">ê° ì¹¸ì— ìƒí’ˆëª…ì„ ì ê³ , â€œì‚¬ìš©ë¨ í‘œì‹œâ€ë¥¼ ëˆ„ë¥´ë©´ ì†ë‹˜ í™”ë©´ì—ì„œ X í‘œì‹œ + ë‚¨ì€ ì¹¸ ìˆ˜ê°€ ì¤„ì–´ë“­ë‹ˆë‹¤.</div>
          <div class="bingo-grid" id="bingoGrid"></div>
          <div class="row" style="margin-top:8px;">
            <span class="desc">ë‚¨ì€ ì¹¸: <strong id="bingoRemain">-</strong></span>
            <div class="spacer"></div>
            <button class="btn btn-outline" id="resetBingoBtn">ë¹™ê³  ì „ì²´ ë¦¬ì…‹</button>
          </div>
        </section>

        <!-- ì‹œì¦Œì „ ì „ì²´ ë­í‚¹ + ì‹œì¦Œ ë±ƒì§€ -->
        <section class="card" id="seasonCard">
          <div class="card-header">
            <div class="card-title">
              ì‹œì¦Œì „ ì „ì²´ ë­í‚¹
              <span class="tag" id="seasonId">-</span>
            </div>
          </div>
          <div class="desc">
            ì‹œì¦Œì „ì€ ìµœëŒ€ 100ëª…ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•˜ë©°, ì†ë‹˜ í™”ë©´ì˜ â€œì „ì²´ë³´ê¸°â€ íŒì—…ì— ê·¸ëŒ€ë¡œ ë…¸ì¶œë©ë‹ˆë‹¤.
            ìœ„ Top 5ëŠ” ì´ ëª©ë¡ì„ ì ìˆ˜(ìˆ«ì) ê¸°ì¤€ìœ¼ë¡œ ìë™ ì •ë ¬í•œ ìƒìœ„ 5ëª…ì…ë‹ˆë‹¤.
          </div>

          <table class="season-table">
            <thead>
              <tr>
                <th>#</th>
                <th>ì´ë¦„</th>
                <th>ì ìˆ˜</th>
                <th class="season-row-actions">ì‚­ì œ</th>
              </tr>
            </thead>
            <tbody id="seasonTbody"></tbody>
          </table>

          <div class="row" style="margin-top:8px;">
            <button class="btn btn-outline" id="addSeasonRowBtn">í–‰ ì¶”ê°€</button>
            <div class="spacer"></div>
            <button class="btn btn-outline" id="seasonResetBtn">ì‹œì¦Œ ID ë¦¬ì…‹</button>
          </div>

          <hr style="border:0;border-top:1px solid rgba(30,64,175,0.7);margin:12px 0;">

          <div class="card-header" style="margin-top:0;">
            <div class="card-title">
              ì‹œì¦Œ ë±ƒì§€ ê´€ë¦¬
              <span class="tag">ëª¨ë“  ì¸ì› ëˆ„ì </span>
            </div>
          </div>
          <div class="desc">
            â€œí˜„ì¬ Top 5 â†’ ì‹œì¦Œ ë±ƒì§€ ëˆ„ì â€ì„ ëˆ„ë¥´ë©´, ëŒ€ë¬¼/ì†Œë¬¼/ì²œí•˜ì œì¼/ì‹œì¦Œ Top5 ì´ë¦„ì´ ì‹œì¦Œ ë±ƒì§€ì— ìë™ ì¶”ê°€ë©ë‹ˆë‹¤.
            í•„ìš”í•˜ë©´ ì´ë¦„ì„ ì§ì ‘ ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤.
          </div>

          <div class="row" style="margin-top:6px; flex-wrap:wrap;">
            <select id="badgeCat" style="max-width:140px;">
              <option value="rank_big">ëŒ€ë¬¼ì™•</option>
              <option value="rank_small">ì†Œë¬¼ì™•</option>
              <option value="rank_tour">ì²œí•˜ì œì¼ ëŒ€íšŒ</option>
              <option value="rank_season">ì‹œì¦Œì „</option>
            </select>
            <input id="badgeNames" type="text" placeholder="ì´ë¦„ì„ ì‰¼í‘œë¡œ ì…ë ¥ (ì˜ˆ: í™ê¸¸ë™, ì´ìˆœì‹ , ë§ˆìŠ¤í„° í‚´)" />
            <button class="btn btn-outline" id="badgeAddBtn">ì´ë¦„ ì¶”ê°€</button>
          </div>

          <div class="row" style="margin-top:6px;">
            <button class="btn btn-outline" id="badgeFromTopBtn">í˜„ì¬ Top 5 â†’ ì‹œì¦Œ ë±ƒì§€ ëˆ„ì </button>
          </div>

          <div class="grid" style="margin-top:10px;">
            <div class="card card-soft" style="grid-column:span 6;">
              <div class="card-header" style="margin-bottom:4px;">
                <div class="card-title" style="font-size:13px;">ëŒ€ë¬¼ì™• ë±ƒì§€</div>
              </div>
              <div class="desc">ì´ë¦„ ì˜† Xë¥¼ ëˆŒëŸ¬ ì‚­ì œ ê°€ëŠ¥</div>
              <div id="badgeList_big" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
            </div>
            <div class="card card-soft" style="grid-column:span 6;">
              <div class="card-header" style="margin-bottom:4px;">
                <div class="card-title" style="font-size:13px;">ì†Œë¬¼ì™• ë±ƒì§€</div>
              </div>
              <div class="desc"></div>
              <div id="badgeList_small" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
            </div>
            <div class="card card-soft" style="grid-column:span 6;">
              <div class="card-header" style="margin-bottom:4px;">
                <div class="card-title" style="font-size:13px;">ì²œí•˜ì œì¼ ëŒ€íšŒ ë±ƒì§€</div>
              </div>
              <div class="desc"></div>
              <div id="badgeList_tour" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
            </div>
            <div class="card card-soft" style="grid-column:span 6;">
              <div class="card-header" style="margin-bottom:4px;">
                <div class="card-title" style="font-size:13px;">ì‹œì¦Œì „ ë±ƒì§€</div>
              </div>
              <div class="desc"></div>
              <div id="badgeList_season" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
            </div>
          </div>
        </section>
      </div>

      <div class="row" style="margin-top:14px;">
        <button class="btn" id="saveBtn">Supabaseì— ì €ì¥</button>
        <button class="btn btn-outline" id="reloadBtn">ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="btn btn-danger" id="resetAllBtn">ì „ì²´ ì´ˆê¸°í™” (ì‹œì¦ŒID ì œì™¸)</button>
        <div class="spacer"></div>
        <span class="desc">â€» ì €ì¥ ì‹œ index.html(ì†ë‹˜ìš©) í™”ë©´ì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.</span>
      </div>
    </div>

    <div class="footer">
      ë°ì´í„°ë¥¼ ìƒì§€ ì•Šìœ¼ë ¤ë©´: Supabase í”„ë¡œì íŠ¸/í…Œì´ë¸”ì„ ì ˆëŒ€ ì‚­ì œí•˜ì§€ ë§ ê²ƒ Â· ë¸Œë¼ìš°ì € ë¹„ë°€ë²ˆí˜¸ëŠ” ì´ PCì—ë§Œ ì €ì¥ë¨
    </div>
  </div>

  <!-- Supabase CDN (window.supabase) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- ===== JS: Supabase + ë¡œì»¬ ë³´ì•ˆ ===== -->
  <script>
    const SUPABASE_URL = 'https://phagmstmqilxyojhhvfn.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBoYWdtc3RtcWlseHlvamhodmZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMTQ5NzAsImV4cCI6MjA3Nzg5MDk3MH0.-qOxDrtWLanL8XtYj_FAs2H91X6cOAiYD4eTsZecLGM';
    const TABLE = 'kkun_state';
    const ROW_ID = 'global';

    const ADMIN_HASH_KEY = 'kkun_admin_hash_v2';
    const ATTEMPT_KEY = 'kkun_admin_attempts';
    const LOCK_UNTIL_KEY = 'kkun_admin_lock_until';
    const MAX_ATTEMPTS = 5;
    const LOCK_MS = 5 * 60 * 1000;

    // Supabase í´ë¼ì´ì–¸íŠ¸ (CDN ë°©ì‹)
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const $ = (sel, el = document) => el.querySelector(sel);
    const $$ = (sel, el = document) => [...el.querySelectorAll(sel)];

    // ğŸ”¹ ê¸°ë³¸ ìƒí’ˆ í…ìŠ¤íŠ¸ (ì†ë‹˜ìš© index.htmlê³¼ ë™ì¼)
    const DEFAULT_PRIZES = {
      rank_big: ['50,000P','30,000P','10,000P','5,000P','3,000P'],
      rank_small: ['50,000P','30,000P','10,000P','5,000P','3,000P'],
      rank_tour: [
        '1ì‹œê°„ í• ì¸ê¶Œ 3ì¥',
        '1ì‹œê°„ í• ì¸ê¶Œ 1ì¥',
        '4,000ì› í• ì¸ê¶Œ 1ì¥',
        '3,000ì› í• ì¸ê¶Œ 1ì¥',
        '2,000ì› í• ì¸ê¶Œ 1ì¥',
      ],
      rank_season: [
        '10ë§ŒP + 1ì‹œê°„ í• ì¸ê¶Œ 3ì¥',
        '7ë§ŒP + 1ì‹œê°„ í• ì¸ê¶Œ 2ì¥',
        '3ë§ŒP + 1ë§Œì› í• ì¸ê¶Œ 1ì¥',
      ],
    };

    function createDefaultState() {
      const bingo = Array.from({ length: 16 }, () => ({ label: '', used: false }));
      return {
        lastUpdated: null,
        season: {
          id: genSeasonId(),
          startedAt: new Date().toISOString(),
          badges: {
            rank_big: [],
            rank_small: [],
            rank_tour: [],
            rank_season: [],
          },
        },
        titles: {
          rank_big: 'ëŒ€ë¬¼ì™•',
          rank_small: 'ì†Œë¬¼ì™•',
          rank_tour: 'ì²œí•˜ì œì¼ ë‚šì‹œëŒ€íšŒ',
          rank_season: 'ì‹œì¦Œì „',
          bingo: 'ì¹˜í‚¨ë¹™ê³ ',
        },
        // ğŸ”¹ ë“±ìˆ˜ë³„ ìƒí’ˆ ê¸°ë³¸ê°’
        prizes: DEFAULT_PRIZES,
        rank_big: [],
        rank_small: [],
        rank_tour: [],
        rank_season: [],
        bingo,
      };
    }

    function mergeWithDefaults(loaded) {
      const base = createDefaultState();
      const merged = {
        ...base,
        ...loaded,
        season: {
          ...base.season,
          ...(loaded.season || {}),
          badges: {
            ...base.season.badges,
            ...(loaded.season && loaded.season.badges ? loaded.season.badges : {}),
          },
        },
        titles: {
          ...base.titles,
          ...(loaded.titles || {}),
        },
        // ğŸ”¹ prizesëŠ” ê¸°ë³¸ê°’ + ì €ì¥ëœ ê°’ í•©ì³ì„œ ì‚¬ìš©
        prizes: {
          ...DEFAULT_PRIZES,
          ...(loaded.prizes || {}),
        },
      };
      return merged;
    }

    function genSeasonId() {
      const d = new Date();
      return `${d.getFullYear()} Q${Math.floor(d.getMonth() / 3) + 1}`;
    }

    function toNumber(v) {
      if (v == null) return 0;
      const n = parseFloat(String(v).replace(/[^0-9.-]/g, ''));
      return Number.isNaN(n) ? 0 : n;
    }

    async function loadStateFromSupabase() {
      try {
        const { data, error } = await supabase
          .from(TABLE)
          .select('state')
          .eq('id', ROW_ID)
          .single();

        if (error) {
          console.error('[admin] load error:', error);
          return createDefaultState();
        }

        if (!data || !data.state || Object.keys(data.state).length === 0) {
          return createDefaultState();
        }

        return mergeWithDefaults(data.state);
      } catch (e) {
        console.error('[admin] exception:', e);
        return createDefaultState();
      }
    }

    /* =====================================================
       âœ… PATCH: ì €ì¥ ì˜¤ë¥˜ ë°©ì§€ìš© ì•ˆì • save í•¨ìˆ˜
       ===================================================== */
    async function saveStateToSupabase(state) {
      // 1ï¸âƒ£ ë¨¼ì € update ì‹œë„ (ì´ë¯¸ global rowê°€ ìˆë‹¤ê³  ê°€ì •)
      const { error: updateError } = await supabase
        .from(TABLE)
        .update({ state })
        .eq('id', ROW_ID);

      // 2ï¸âƒ£ updateê°€ ì‹¤íŒ¨(í–‰ ì—†ìŒ ë“±)í•˜ë©´ insertë¡œ ìƒì„±
      if (updateError) {
        console.warn('[admin] update ì‹¤íŒ¨, insertë¡œ ì¬ì‹œë„:', updateError);
        const { error: insertError } = await supabase
          .from(TABLE)
          .insert([{ id: ROW_ID, state }]);

        if (insertError) {
          console.error('[admin] insertë„ ì‹¤íŒ¨:', insertError);
          throw insertError;
        }
      }
    }

    function nowISO() {
      return new Date().toISOString();
    }

    function updateLastSaved(state) {
      $('#lastSaved').textContent = state.lastUpdated
        ? new Date(state.lastUpdated).toLocaleString('ko-KR')
        : '-';
    }

    /* ===== ë¹„ë°€ë²ˆí˜¸ ê´€ë ¨ ===== */
    async function sha256(text) {
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(text));
      return Array.from(new Uint8Array(buf))
        .map((b) => b.toString(16).padStart(2, '0'))
        .join('');
    }

    // ğŸ” ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸ admin1234 ìë™ ì„¸íŒ… (ì´ë¯¸ ìˆìœ¼ë©´ ê±´ë“œë¦¬ì§€ ì•ŠìŒ)
    async function ensureDefaultAdminPassword() {
      const existing = localStorage.getItem(ADMIN_HASH_KEY);
      if (!existing) {
        const hash = await sha256('admin1234');
        localStorage.setItem(ADMIN_HASH_KEY, hash);
      }
    }

    function showGate() {
      const hasPw = !!localStorage.getItem(ADMIN_HASH_KEY);
      $('#setupBox').style.display = hasPw ? 'none' : 'block';
      $('#loginBox').style.display = hasPw ? 'block' : 'none';
      $('#gate').scrollIntoView({ behavior: 'smooth', block: 'start' });
      updateGateMsg();
    }

    function updateGateMsg() {
      const lockUntil = parseInt(localStorage.getItem(LOCK_UNTIL_KEY) || '0', 10);
      const msgEl = $('#gateMsg');
      if (!msgEl) return;

      if (Date.now() < lockUntil) {
        const left = Math.ceil((lockUntil - Date.now()) / 1000);
        msgEl.textContent = `ë¡œê·¸ì¸ ì ê¸ˆ ìƒíƒœì…ë‹ˆë‹¤. ${left}ì´ˆ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.`;
      } else {
        msgEl.textContent = 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ê´€ë¦¬ì í™”ë©´ì´ ì—´ë¦½ë‹ˆë‹¤.';
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.altKey && e.key.toLowerCase() === 'a') {
        showGate();
      }
    });

    $('#setPwBtn')?.addEventListener('click', async () => {
      const a = $('#newPw').value.trim();
      const b = $('#newPw2').value.trim();
      if (a.length < 6) {
        alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.');
        return;
      }
      if (a !== b) {
        alert('ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }
      const hash = await sha256(a);
      localStorage.setItem(ADMIN_HASH_KEY, hash);
      localStorage.removeItem(LOCK_UNTIL_KEY);
      sessionStorage.removeItem(ATTEMPT_KEY);
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      showGate();
    });

    $('#loginBtn')?.addEventListener('click', async () => {
      const lockUntil = parseInt(localStorage.getItem(LOCK_UNTIL_KEY) || '0', 10);
      if (Date.now() < lockUntil) {
        updateGateMsg();
        return;
      }

      const input = $('#pw').value;
      const hash = await sha256(input);
      const saved = localStorage.getItem(ADMIN_HASH_KEY);

      if (saved && hash === saved) {
        // ì„±ê³µ
        $('#gate').style.display = 'none';
        $('#panel').style.display = 'block';
        sessionStorage.removeItem(ATTEMPT_KEY);
        localStorage.removeItem(LOCK_UNTIL_KEY);
        boot();
      } else {
        let attempts = parseInt(sessionStorage.getItem(ATTEMPT_KEY) || '0', 10) + 1;
        sessionStorage.setItem(ATTEMPT_KEY, String(attempts));

        if (attempts >= MAX_ATTEMPTS) {
          localStorage.setItem(LOCK_UNTIL_KEY, String(Date.now() + LOCK_MS));
          sessionStorage.removeItem(ATTEMPT_KEY);
          alert('ë¡œê·¸ì¸ ì‹œë„ ì´ˆê³¼ë¡œ 5ë¶„ê°„ ì ê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
          alert(`ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì‹œë„ ${attempts}/${MAX_ATTEMPTS})`);
        }
        updateGateMsg();
      }
    });

    $('#changePwToggle')?.addEventListener('click', () => {
      const box = $('#changePwBox');
      box.style.display = box.style.display === 'none' || !box.style.display ? 'block' : 'none';
    });

    $('#applyPwBtn')?.addEventListener('click', async () => {
      const cur = $('#curPw').value;
      const a = $('#npw1').value;
      const b = $('#npw2').value;

      if (a !== b) {
        alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }
      if (a.length < 6) {
        alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.');
        return;
      }
      const saved = localStorage.getItem(ADMIN_HASH_KEY);
      if (saved) {
        const hashCur = await sha256(cur);
        if (hashCur !== saved) {
          alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          return;
        }
      }
      const hashNew = await sha256(a);
      localStorage.setItem(ADMIN_HASH_KEY, hashNew);
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
      $('#changePwBox').style.display = 'none';
    });

    /* ===== ìƒíƒœ ë° UI ë°”ì¸ë”© ===== */
    let state = createDefaultState();

    function rankFormHTML(key) {
      const rows = Array.from({ length: 5 }, (_, i) => {
        return `
          <tr>
            <td>${i + 1}</td>
            <td><input type="text" data-role="name" data-key="${key}" data-idx="${i}" placeholder="ì´ë¦„"></td>
            <td><input type="text" data-role="score" data-key="${key}" data-idx="${i}" placeholder="ì ìˆ˜ (ìˆ«ì ìš°ì„ )"></td>
          </tr>
        `;
      }).join('');
      return `
        <table>
          <thead>
            <tr><th>#</th><th>ì´ë¦„</th><th>ì ìˆ˜</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }

    function mountRankForms() {
      ['rank_big', 'rank_small', 'rank_tour'].forEach((key) => {
        const host = document.querySelector(`[data-key="${key}"]`);
        host.innerHTML = rankFormHTML(key);
        const arr = state[key] || [];
        arr.slice(0, 5).forEach((item, i) => {
          const nm = document.querySelector(`input[data-role="name"][data-key="${key}"][data-idx="${i}"]`);
          const sc = document.querySelector(`input[data-role="score"][data-key="${key}"][data-idx="${i}"]`);
          if (nm) nm.value = item.name || '';
          if (sc) sc.value = item.score ?? '';
        });
      });
    }

    function renderTitlesAdmin() {
      const t = state.titles || {};
      $('#title_rank_big').value = t.rank_big || 'ëŒ€ë¬¼ì™•';
      $('#title_rank_small').value = t.rank_small || 'ì†Œë¬¼ì™•';
      $('#title_rank_tour').value = t.rank_tour || 'ì²œí•˜ì œì¼ ë‚šì‹œëŒ€íšŒ';
      $('#title_rank_season').value = t.rank_season || 'ì‹œì¦Œì „';
      $('#title_bingo').value = t.bingo || 'ì¹˜í‚¨ë¹™ê³ ';

      $$('[data-title-display]').forEach((el) => {
        const key = el.getAttribute('data-title-display');
        if (!key) return;
        if (key === 'bingo') {
          el.textContent = (t.bingo || 'ì¹˜í‚¨ë¹™ê³ ') + ' 4 Ã— 4';
        } else if (key === 'rank_season') {
          el.textContent = (t.rank_season || 'ì‹œì¦Œì „') + ' Top 5';
        } else {
          el.textContent = t[key] || el.textContent;
        }
      });
    }

    function applyTitleInputsToState() {
      state.titles = state.titles || {};
      state.titles.rank_big = $('#title_rank_big').value.trim() || 'ëŒ€ë¬¼ì™•';
      state.titles.rank_small = $('#title_rank_small').value.trim() || 'ì†Œë¬¼ì™•';
      state.titles.rank_tour = $('#title_rank_tour').value.trim() || 'ì²œí•˜ì œì¼ ë‚šì‹œëŒ€íšŒ';
      state.titles.rank_season = $('#title_rank_season').value.trim() || 'ì‹œì¦Œì „';
      state.titles.bingo = $('#title_bingo').value.trim() || 'ì¹˜í‚¨ë¹™ê³ ';
    }

    // ğŸ”¹ ìƒí’ˆ ì…ë ¥ê°’ì„ í™”ë©´ì— ì±„ìš°ê¸°
    function renderPrizesAdmin() {
      const p = state.prizes || DEFAULT_PRIZES;
      const keys = ['rank_big', 'rank_small', 'rank_tour', 'rank_season'];
      keys.forEach((key) => {
        const arr = p[key] || [];
        for (let i = 0; i < 5; i++) {
          const el = document.getElementById(`prize_${key}_${i}`);
          if (!el) continue;
          el.value = arr[i] || '';
        }
      });
    }

    // ğŸ”¹ í™”ë©´ ì…ë ¥ê°’ â†’ state.prizes ë¡œ ë°˜ì˜
    function applyPrizeInputsToState() {
      state.prizes = state.prizes || {};
      const keys = ['rank_big', 'rank_small', 'rank_tour', 'rank_season'];
      keys.forEach((key) => {
        const arr = [];
        for (let i = 0; i < 5; i++) {
          const el = document.getElementById(`prize_${key}_${i}`);
          const v = (el?.value || '').trim();
          arr.push(v); // ë¹„ì›Œë‘ë©´ ''ìœ¼ë¡œ ì €ì¥ â†’ ì†ë‹˜ í™”ë©´ì—ì„œ í‘œì‹œ ì•ˆ ë¨
        }
        state.prizes[key] = arr;
      });
    }

    function renderBingoEditor() {
      const grid = $('#bingoGrid');
      grid.innerHTML = '';
      let remain = 0;

      (state.bingo || []).forEach((cell, idx) => {
        const div = document.createElement('div');
        div.className = 'bingo-cell' + (cell.used ? ' used' : '');
        const row1 = document.createElement('div');
        row1.className = 'row bingo-label-row';
        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'ìƒí’ˆëª… (ì˜ˆ: ì¹˜í‚¨/ìŒë£Œ/1ì²œP)';
        input.value = cell.label || '';
        input.addEventListener('input', () => {
          state.bingo[idx].label = input.value;
        });
        row1.appendChild(input);

        const row2 = document.createElement('div');
        row2.className = 'row bingo-btn-row';
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'btn btn-outline';
        btn.textContent = cell.used ? 'ì‚¬ìš©ë¨ í•´ì œ' : 'ì‚¬ìš©ë¨ í‘œì‹œ';
        btn.addEventListener('click', () => {
          state.bingo[idx].used = !state.bingo[idx].used;
          renderBingoEditor();
        });
        row2.appendChild(btn);

        div.appendChild(row1);
        div.appendChild(row2);
        grid.appendChild(div);
        if (!cell.used) remain += 1;
      });

      $('#bingoRemain').textContent = remain;
    }

    function renderSeasonTable() {
      const tbody = $('#seasonTbody');
      tbody.innerHTML = '';
      const arr = state.rank_season || [];

      arr.forEach((item, idx) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td><input type="text" data-season-role="name" data-idx="${idx}" value="${item.name || ''}" placeholder="ì´ë¦„"></td>
          <td><input type="text" data-season-role="score" data-idx="${idx}" value="${item.score || ''}" placeholder="ì ìˆ˜ (ìˆ«ì ìš°ì„ )"></td>
          <td class="season-row-actions"><span class="link-danger" data-season-role="del" data-idx="${idx}">ì‚­ì œ</span></td>
        `;
        tbody.appendChild(tr);
      });

      $$('input[data-season-role="name"]').forEach((el) => {
        el.addEventListener('input', () => {
          const i = Number(el.dataset.idx);
          state.rank_season[i] = state.rank_season[i] || { name: '', score: '' };
          state.rank_season[i].name = el.value;
        });
      });
      $$('input[data-season-role="score"]').forEach((el) => {
        el.addEventListener('input', () => {
          const i = Number(el.dataset.idx);
          state.rank_season[i] = state.rank_season[i] || { name: '', score: '' };
          state.rank_season[i].score = el.value;
        });
      });
      $$('span[data-season-role="del"]').forEach((el) => {
        el.addEventListener('click', () => {
          const i = Number(el.dataset.idx);
          if (!confirm('ì´ í–‰ì„ ì‚­ì œí• ê¹Œìš”?')) return;
          state.rank_season.splice(i, 1);
          renderSeasonTable();
        });
      });

      $('#seasonId').textContent = state.season?.id || '-';
    }

    function renderBadgesAdmin() {
      const badges = state.season?.badges || {};
      const keys = ['rank_big', 'rank_small', 'rank_tour', 'rank_season'];
      const idMap = {
        rank_big: 'badgeList_big',
        rank_small: 'badgeList_small',
        rank_tour: 'badgeList_tour',
        rank_season: 'badgeList_season',
      };

      keys.forEach((key) => {
        const box = document.getElementById(idMap[key]);
        box.innerHTML = '';
        const arr = badges[key] || [];
        if (arr.length === 0) {
          const span = document.createElement('span');
          span.textContent = 'ì•„ì§ ì—†ìŒ';
          span.style.fontSize = '11px';
          span.style.color = 'var(--muted)';
          box.appendChild(span);
          return;
        }

        arr.forEach((name) => {
          const wrap = document.createElement('span');
          wrap.style.display = 'inline-flex';
          wrap.style.alignItems = 'center';
          wrap.style.gap = '4px';
          wrap.style.padding = '2px 8px';
          wrap.style.borderRadius = '999px';
          wrap.style.border = '1px solid rgba(56,189,248,0.7)';
          wrap.style.background = 'rgba(15,23,42,0.9)';
          wrap.style.fontSize = '11px';
          wrap.style.color = '#e5e7eb';

          const text = document.createElement('span');
          text.textContent = name;
          const x = document.createElement('span');
          x.textContent = 'âœ•';
          x.style.cursor = 'pointer';
          x.style.color = '#fb7185';
          x.style.fontSize = '11px';
          x.addEventListener('click', () => {
            state.season.badges[key] = (state.season.badges[key] || []).filter((n) => n !== name);
            renderBadgesAdmin();
          });

          wrap.appendChild(text);
          wrap.appendChild(x);
          box.appendChild(wrap);
        });
      });
    }

    $('#addSeasonRowBtn')?.addEventListener('click', () => {
      state.rank_season = state.rank_season || [];
      if (state.rank_season.length >= 100) {
        alert('ìµœëŒ€ 100ëª…ê¹Œì§€ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
      }
      state.rank_season.push({ name: '', score: '' });
      renderSeasonTable();
    });

    $('#seasonResetBtn')?.addEventListener('click', () => {
      if (!confirm('ì‹œì¦Œ IDë¥¼ ìƒˆë¡œ ë§Œë“¤ê³ , ì‹œì¦Œ ë±ƒì§€/ë­í‚¹ì€ ê·¸ëŒ€ë¡œ ë‘˜ê¹Œìš”?')) return;
      state.season = state.season || { id: genSeasonId(), startedAt: nowISO(), badges: {} };
      state.season.id = genSeasonId();
      state.season.startedAt = nowISO();
      state.season.badges = state.season.badges || {
        rank_big: [],
        rank_small: [],
        rank_tour: [],
        rank_season: [],
      };
      $('#seasonId').textContent = state.season.id;
      alert('ìƒˆ ì‹œì¦Œ IDê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });

    $('#resetBingoBtn')?.addEventListener('click', () => {
      if (!confirm('ì¹˜í‚¨ë¹™ê³ ë¥¼ ì „ì²´ ë¦¬ì…‹í• ê¹Œìš”?')) return;
      state.bingo = Array.from({ length: 16 }, () => ({ label: '', used: false }));
      renderBingoEditor();
    });

    $('#badgeAddBtn')?.addEventListener('click', () => {
      const cat = $('#badgeCat').value;
      const names = $('#badgeNames').value.split(',').map((s) => s.trim()).filter(Boolean);
      if (names.length === 0) {
        alert('ì¶”ê°€í•  ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      state.season = state.season || { id: genSeasonId(), startedAt: nowISO(), badges: {} };
      state.season.badges = state.season.badges || {
        rank_big: [],
        rank_small: [],
        rank_tour: [],
        rank_season: [],
      };
      const cur = state.season.badges[cat] || [];
      state.season.badges[cat] = [...new Set([...cur, ...names])];
      $('#badgeNames').value = '';
      renderBadgesAdmin();
    });

    $('#badgeFromTopBtn')?.addEventListener('click', () => {
      state.season = state.season || { id: genSeasonId(), startedAt: nowISO(), badges: {} };
      state.season.badges = state.season.badges || {
        rank_big: [],
        rank_small: [],
        rank_tour: [],
        rank_season: [],
      };

      const keys = ['rank_big', 'rank_small', 'rank_tour', 'rank_season'];
      keys.forEach((key) => {
        const src =
          key === 'rank_season'
            ? (state.rank_season || [])
                .slice()
                .sort((a, b) => toNumber(b.score) - toNumber(a.score))
                .slice(0, 5)
            : (state[key] || []);
        const names = src.map((x) => x.name).filter(Boolean);
        const cur = state.season.badges[key] || [];
        state.season.badges[key] = [...new Set([...cur, ...names])];
      });

      renderBadgesAdmin();
      alert('í˜„ì¬ Top 5ê°€ ì‹œì¦Œ ë±ƒì§€ì— ëˆ„ì ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });

    $('#saveBtn')?.addEventListener('click', async () => {
      // ë­í‚¹ ê°’ ì½ì–´ì˜¤ê¸°
      ['rank_big', 'rank_small', 'rank_tour'].forEach((key) => {
        const list = [];
        for (let i = 0; i < 5; i++) {
          const nm = document.querySelector(`input[data-role="name"][data-key="${key}"][data-idx="${i}"]`)?.value.trim() || '';
          const sc = document.querySelector(`input[data-role="score"][data-key="${key}"][data-idx="${i}"]`)?.value.trim() || '';
          if (nm || sc) list.push({ name: nm, score: sc });
        }
        state[key] = list;
      });

      // ì œëª© ì…ë ¥ê°’ì„ ìƒíƒœì— ë°˜ì˜
      applyTitleInputsToState();
      // ìƒí’ˆ ì…ë ¥ê°’ì„ ìƒíƒœì— ë°˜ì˜
      applyPrizeInputsToState();
      console.log('PRIZE_CONFIG', state.PRIZE_CONFIG);
      state.lastUpdated = nowISO();

      try {
        await saveStateToSupabase(state);
        updateLastSaved(state);
        alert('Supabaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì†ë‹˜ í™”ë©´ë„ ìë™ìœ¼ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤.');
      } catch (e) {
        alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†” ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
      }
    });

    $('#reloadBtn')?.addEventListener('click', async () => {
      if (!confirm('Supabaseì—ì„œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¬ê¹Œìš”? (ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ ë‚´ìš©ì€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.)')) return;
      state = await loadStateFromSupabase();
      mountRankForms();
      renderBingoEditor();
      renderSeasonTable();
      renderBadgesAdmin();
      renderTitlesAdmin();
      renderPrizesAdmin();
      updateLastSaved(state);
    });

    $('#resetAllBtn')?.addEventListener('click', async () => {
      if (!confirm('ë­í‚¹ + ë¹™ê³ ë¥¼ ì „ë¶€ ì´ˆê¸°í™”í• ê¹Œìš”? (ì‹œì¦Œ IDì™€ ë±ƒì§€ ëª©ë¡, ì œëª©, ìƒí’ˆ ì„¤ì •ì€ ìœ ì§€)')) return;
      const keepSeason = state.season;
      const keepTitles = state.titles;
      const keepPrizes = state.prizes;
      state = createDefaultState();
      state.season = keepSeason || state.season;
      state.titles = keepTitles || state.titles;
      state.prizes = keepPrizes || state.prizes;
      state.lastUpdated = nowISO();
      mountRankForms();
      renderBingoEditor();
      renderSeasonTable();
      renderBadgesAdmin();
      renderTitlesAdmin();
      renderPrizesAdmin();
      updateLastSaved(state);
      try {
        await saveStateToSupabase(state);
        alert('ì´ˆê¸°í™” í›„ Supabaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } catch (e) {
        alert('ì´ˆê¸°í™” ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.');
      }
    });

    async function boot() {
      state = await loadStateFromSupabase();
      mountRankForms();
      renderBingoEditor();
      renderSeasonTable();
      renderBadgesAdmin();
      renderTitlesAdmin();
      renderPrizesAdmin();
      updateLastSaved(state);
    }

    // í˜ì´ì§€ ì²« ì§„ì…: ê¸°ë³¸ ë¹„ë²ˆ(admin1234) ì—†ìœ¼ë©´ ìƒì„± í›„, ê²Œì´íŠ¸ í‘œì‹œ
    (async () => {
      await ensureDefaultAdminPassword();
      showGate();
    })();
  </script>
</body>
</html>
